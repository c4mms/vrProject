<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Showroom 3D</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
    <script>
      AFRAME.registerComponent('teleport-controls-fix', {
        init: function () {
          this.el.setAttribute('teleport-controls', {
            button: 'trigger',
            collisionEntities: '[teleportable]',
            cameraRig: '#rig',
            teleportOrigin: '#head',
            type: 'parabolic',
          });
        }
      });

      AFRAME.registerComponent('vr-toggle', {
        init: function () {
          const rig = document.getElementById('rig');
          const orbitCam = document.getElementById('orbitCam');

          this.el.sceneEl.addEventListener('enter-vr', () => {
            rig.setAttribute('visible', true);
            orbitCam.setAttribute('visible', false);
          });

          this.el.sceneEl.addEventListener('exit-vr', () => {
            rig.setAttribute('visible', false);
            orbitCam.setAttribute('visible', true);
          });

          // Default to orbitCam visible
          rig.setAttribute('visible', false);
          orbitCam.setAttribute('visible', true);
        }
      });
    </script>
  </head>
  <body>
    <a-scene vr-mode-ui="enabled: true" vr-toggle>
      <a-assets timeout="20000">
        <a-asset-item id="showroom-model" src="https://showroomcd.s3.amazonaws.com/showroom.glb"></a-asset-item>
      </a-assets>

      <!-- Ground marked as teleportable -->
      <a-plane teleportable rotation="-90 0 0" width="100" height="100" color="#ccc"></a-plane>

      <!-- Model -->
      <a-entity gltf-model="#showroom-model" position="0 -1.6 -5" scale="0.8 0.8 0.8"></a-entity>

      <!-- VR Camera rig (hidden in desktop mode) -->
      <a-entity id="rig" position="0 0 0">
        <a-entity id="head" camera look-controls wasd-controls position="0 1.6 0"></a-entity>
        <a-entity laser-controls="hand: left" teleport-controls-fix></a-entity>
        <a-entity laser-controls="hand: right"></a-entity>
      </a-entity>

      <!-- Orbit camera (only visible in desktop mode) -->
      <a-entity id="orbitCam" camera position="0 2 5" orbit-controls="target: 0 1 0; enableDamping: true;"></a-entity>
    </a-scene>
  </body>
</html>
