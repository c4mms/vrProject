<!DOCTYPE html>
<html>
<head>
    <title>Teletrasporto e Rotazione VR con A-Frame (Debug)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>
AFRAME.registerComponent('teleport-controls', {
    schema: {},

    init: function () {
        const el = this.el;
        const sceneEl = el.sceneEl;

        el.setAttribute('laser-controls', { hand: 'right' });
        el.setAttribute('raycaster', {
            objects: '.teleportable',
            far: 10,
            interval: 0, // forza aggiornamento continuo
            showLine: true
        });

        this.teleportCircle = document.createElement('a-entity');
        this.teleportCircle.setAttribute('geometry', { primitive: 'circle', radius: 0.5 });
        this.teleportCircle.setAttribute('material', { color: 'blue', shader: 'flat', transparent: true, opacity: 0.5 });
        this.teleportCircle.setAttribute('rotation', '-90 0 0');
        this.teleportCircle.setAttribute('visible', false);
        sceneEl.appendChild(this.teleportCircle);

        this.intersectionPoint = null;
    },

    tick: function () {
        const raycaster = this.el.components.raycaster;
        if (!raycaster) return;

        const intersections = raycaster.intersections;
        if (intersections.length > 0 && intersections[0].object.el.classList.contains('teleportable')) {
            const point = intersections[0].point;
            this.intersectionPoint = point;
            this.teleportCircle.setAttribute('visible', true);
            this.teleportCircle.setAttribute('position', point);
        } else {
            this.teleportCircle.setAttribute('visible', false);
            this.intersectionPoint = null;
        }
    },

    events: {
        triggerdown: function () {
            if (this.intersectionPoint) {
                const cameraRig = this.el.sceneEl.querySelector('#cameraRig');
                const headPosition = this.el.sceneEl.querySelector('#camera').getAttribute('position');

                cameraRig.setAttribute('position', {
                    x: this.intersectionPoint.x - headPosition.x,
                    y: cameraRig.getAttribute('position').y,
                    z: this.intersectionPoint.z - headPosition.z
                });
            }
        }
    }
});
    </script>
</head>
<body>
    <a-scene>
        <a-entity id="cameraRig" position="0 0 0">
            <a-entity id="camera" camera position="0 1.6 0" look-controls></a-entity>
            <a-entity id="rightHand" teleport-controls joystick-rotation></a-entity>
            <a-entity id="leftHand" laser-controls="hand: left" raycaster="objects: .teleportable; far: 10; showLine: true"></a-entity>
        </a-entity>

        <a-plane class="teleportable" position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
        <a-sky color="#ECECEC"></a-sky>
    </a-scene>
</body>
</html>
